<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trabalho 2</title>
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <!-- Skeleton template -->
    <div class="d-none" id="skeleton-template">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title placeholder-glow">
            <span class="placeholder col-6"></span>
          </h5>
          <h6 class="card-subtitle mb-2 text-muted placeholder-glow">
            <span class="placeholder col-4"></span>
          </h6>
          <p class="card-text placeholder-glow">
            <span class="placeholder col-7"></span>
            <span class="placeholder col-4"></span>
            <span class="placeholder col-6"></span>
            <span class="placeholder col-8"></span>
          </p>
          <button class="btn btn-primary disabled placeholder col-3"></button>
        </div>
      </div>
    </div>

    <!-- Post template -->
    <div class="d-none" id="post-template">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title" id="post-title">Post Title</h5>
          <h6 class="card-subtitle mb-2 text-muted" id="post-user">
            User ID: 1
          </h6>
          <p class="card-text" id="post-body">Post body content goes here.</p>
          <button class="btn btn-primary" id="comment-btn">
            View Comments
          </button>
        </div>
      </div>
    </div>

    <!-- Skeleton for comments in modal -->
    <div class="d-none" id="skeleton-comment">
      <div class="placeholder-glow mb-2">
        <p><span class="placeholder col-4"></span></p>
        <p><span class="placeholder col-8"></span></p>
        <p><span class="placeholder col-6"></span></p>
      </div>
    </div>

    <!-- Modal for comments -->
    <div
      class="modal fade"
      id="commentsModal"
      tabindex="-1"
      aria-labelledby="commentsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="commentsModalLabel">Comments</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="comments-container">
            <!-- Comments or skeleton will be loaded here -->
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- A list that has all posts as a flex col -->
    <div class="container d-flex flex-column p-2" id="posts-container"></div>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        const postsContainer = $("#posts-container");

        // Show 5 skeleton loaders while data loads
        for (let i = 0; i < 5; i++) {
          const skeleton = $("#skeleton-template").clone();
          skeleton.removeClass("d-none");
          postsContainer.append(skeleton);
        }

        // Fetch posts data
        $.ajax({
          url: "https://jsonplaceholder.typicode.com/posts",
          type: "GET",
          success: function (data) {
            // Clear skeletons
            postsContainer.empty();

            // Populate posts
            data.forEach((post) => {
              const postTemplate = $("#post-template").clone();
              postTemplate.removeClass("d-none");
              postTemplate.find("#post-title").text(post.title);
              postTemplate.find("#post-user").text(`User ID: ${post.userId}`);
              postTemplate.find("#post-body").text(post.body);

              // Handle comments
              postTemplate.find("#comment-btn").click(function () {
                const commentsContainer = $("#comments-container");

                // Clear previous comments and show skeleton
                commentsContainer.empty();
                for (let i = 0; i < 5; i++) {
                  const skeletonComment = $("#skeleton-comment").clone();
                  skeletonComment.removeClass("d-none");
                  commentsContainer.append(skeletonComment);
                }

                // Open the modal
                $("#commentsModal").modal("show");

                // Fetch comments
                fetchComments(post.id).then((comments) => {
                  // Clear skeletons and display actual comments
                  commentsContainer.empty();
                  comments.forEach((comment) => {
                    commentsContainer.append(
                      `<p><strong>${comment.name}</strong> - ${comment.body}</p>`
                    );
                  });
                });
              });

              postsContainer.append(postTemplate);
            });
          },
        });
      });

      async function fetchComments(postId) {
        // Fetch comments data
        const response = await fetch(
          `https://jsonplaceholder.typicode.com/posts/${postId}/comments`
        );

        if (response.status !== 200) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        return response.json();
      }
    </script>

    <!-- Bootstrap -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
